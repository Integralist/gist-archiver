<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>[Basic parsing of go.mod with Rust] #rust #go #golang</title>
<style>
body { font-family: sans-serif; margin: 20px; line-height: 1.6; background-color: #f4f4f4; color: #333; }
.container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
pre { background: #f0f0f0; padding: 1em; border-radius: 5px; overflow-x: auto; border: 1px solid #ddd; }
code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.9em;}
h1, h2 { border-bottom: 1px solid #eee; padding-bottom: 0.3em;}
a.back-link { display: inline-block; margin-bottom: 20px; color: #007bff; text-decoration: none; }
a.back-link:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="container">
<a href="../index.html" class="back-link">&laquo; Back to Index</a>
<h1 id="basic-parsing-of-go-mod-with-rust-rust-go-golang">[Basic parsing of go.mod with Rust] #rust #go #golang</h1>

<h2 id="go-mod">go.mod</h2>

<pre><code class="language-go">module whatever

go 1.18

require example.com/foo/bar v1.0.0
require example.com/foo/bar/v2 v2.0.0

require (
    example.com/beep/boop v3.0.0
    example.com/quick/quack v4.0.0
)

require (
    example.com/something/else v5.0.0
)
</code></pre>

<h2 id="main-rs">main.rs</h2>

<pre><code class="language-rust">// https://go.dev/ref/mod#go-mod-file-require
// https://go.dev/ref/mod#pseudo-versions

use semver::Version;

type AvailableDependency = (String, Version, Vec&lt;String&gt;);

const GO_MOD: &amp;str = include_str!(&quot;../go.mod&quot;);

fn main() {
    let mut block = false;
    let deps: Vec&lt;AvailableDependency&gt; = GO_MOD
        .lines()
        .filter_map(|v| {
            let segs: Vec&lt;&amp;str&gt; = v.split(' ').collect();
            if segs.len() == 1 {
                if segs[0] == &quot;)&quot; {
                    block = false;
                }
                return None;
            }
            if block {
                let nested_dep: Vec&lt;_&gt; = segs.iter().filter(|v| !v.is_empty()).collect();
                let mut version = nested_dep[1].chars();
                version.next();

                return Some((
                    nested_dep[0].to_string(),
                    Version::parse(version.as_str())
                        .expect(&quot;could not parse default dependency version&quot;),
                    vec![],
                ));
            }
            if segs[0] == &quot;require&quot; {
                if segs[1] == &quot;(&quot; {
                    block = true;
                    return None;
                }

                let slice = &amp;segs[1..];
                let mut version = slice[1].chars();
                version.next();

                return Some((
                    slice[0].to_string(),
                    Version::parse(version.as_str())
                        .expect(&quot;could not parse default dependency version&quot;),
                    vec![],
                ));
            }
            None
        })
        .collect();

    println!(&quot;{:#?}&quot;, deps);
}
</code></pre>

<h2 id="cargo-toml">Cargo.toml</h2>

<pre><code class="language-toml">[package]
name = &quot;testing-parse-gomod&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
semver = &quot;1.0.4&quot;
</code></pre>

</div>
</body>
</html>