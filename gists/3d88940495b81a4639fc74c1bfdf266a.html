<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>[Bitwise Operations in Go] #go #golang #bitwise #bit</title>
<link rel="stylesheet" type="text/css" href="../assets/css/styles.css">
</head>
<body>
<div class="container">
<a href="../index.html" class="back-link">&laquo; Back to Index</a>
<h1 id="bitwise-operations-in-go-go-golang-bitwise-bit">[Bitwise Operations in Go] #go #golang #bitwise #bit</h1>

<h2 id="1-readme-md">1. README.md</h2>

<pre><code class="language-markdown"># Bitwise Operations in Go

In the below Go file we use bitwise operators to manipulate individual flags (on/off switches) in a single integer, where each bit position represents a different status.

## Visualising Bits

In case you need a reminder of a what bit alignment and shifting look like:

![example of bits in a byte](https://www.integralist.co.uk/images/bits-visualised.png)

## Defining Bit Flags

Each status is assigned a unique power of 2 using bit shifting (`1 &lt;&lt; iota`). 

This ensures each flag only affects a single bit:

- `StatusActive` has the binary value `0001` (`1 &lt;&lt; 0` == 1 in decimal).
- `StatusAdmin` has the binary value `0010` (`1 &lt;&lt; 1` == 2 in decimal).
- `StatusBanned` has the binary value `0100` (`1 &lt;&lt; 2` == 4 in decimal).
- `StatusVerified` has the binary value `1000` (`1 &lt;&lt; 3` == 8 in decimal).

## Setting Statuses

The following example combines two separate status flags:

</code></pre>

<p>userStatus |= StatusActive | StatusVerified</p>

<pre><code>
In binary, this results in `1001` (or 9 in decimal), which means both the &quot;active&quot; and &quot;verified&quot; flags are set.

## Adding and Removing Flags

The following example sets the &quot;admin&quot; bit without affecting the other bits, resulting in `1011` (11 in decimal):

</code></pre>

<p>userStatus |= StatusAdmin</p>

<pre><code>
## Comparing Statuses

Once `userStatus` has combined flags we can use the `&amp;` operator to perform a bitwise `AND` operation, which means it compares each bit of two integers. For each bit position, if both bits are 1, the result at that position will be 1; otherwise, it will be 0.

So what happens when we compare `userStatus&amp;StatusAdmin != 0`?

Well, `StatusAdmin` is a bit flag defined as `1 &lt;&lt; 1`, which results in `0010` in binary. This means that `StatusAdmin` occupies the second bit position in the binary representation of an integer. When we do `userStatus&amp;StatusAdmin`, we're effectively &quot;masking&quot; all bits except for the one represented by StatusAdmin (this is known as **bit masking**).

When we perform `userStatus&amp;StatusAdmin`, we get a result where only the bit corresponding to `StatusAdmin` remains (and is set to `1` if that bit was already set in `userStatus`). If this result is non-zero (`!= 0`), it means the `StatusAdmin` bit is set in `userStatus`. If it's zero, then `StatusAdmin` is not set in `userStatus`.

If we look at the code in `bitwise.go` we'll see `userStatus` is initially set to include `StatusActive` and `StatusVerified`, so `userStatus` is `1001` in binary (which is `9` in decimal). Remember `StatusActive` occupied the first bit position (`0001`), while `StatusVerified` occupied the fourth bit position (`1000`) so if setting both flags we get the combined `1001`.

Next, we add the `StatusAdmin` flag with `userStatus |= StatusAdmin`, making `userStatus` now `1011` in binary (which is 11 in decimal). When we check if `StatusAdmin` is set using `userStatus&amp;StatusAdmin != 0` we get back `2` from `userStatus&amp;StatusAdmin` (which is `0010` in binary) because we've bit masked the other bits that might have been turned on (if you recall, using `&amp;` turns each bit to zero except for those bits that were 1 in both numbers being compared), in order to _reveal_ whether the `StatusAdmin` bit was set on or not (i.e. `0` != `2` so we know this person is an admin).
</code></pre>

<h2 id="bitwise-go">bitwise.go</h2>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;strings&quot;
)

// Define bit flags as constants, where each status is represented by a unique bit position
const (
	StatusActive   = 1 &lt;&lt; iota // 1 &lt;&lt; 0 which is 0001 (binary)
	StatusAdmin                // 1 &lt;&lt; 1 which is 0010
	StatusBanned               // 1 &lt;&lt; 2 which is 0100
	StatusVerified             // 1 &lt;&lt; 3 which is 1000
)

// Stringify statuses for easier output
func stringifyStatus(status int) string {
	statuses := []string{}

	if status&amp;StatusActive != 0 {
		statuses = append(statuses, &quot;Active&quot;)
	}
	if status&amp;StatusAdmin != 0 {
		statuses = append(statuses, &quot;Admin&quot;)
	}
	if status&amp;StatusBanned != 0 {
		statuses = append(statuses, &quot;Banned&quot;)
	}
	if status&amp;StatusVerified != 0 {
		statuses = append(statuses, &quot;Verified&quot;)
	}

	return strings.Join(statuses, &quot;, &quot;)
}

func main() {
	// Let's create a user status and use bitwise OR to combine different flags

	var userStatus int

	// Set the user as active and verified
	userStatus |= StatusActive | StatusVerified
	fmt.Println(&quot;Initial Status:&quot;, stringifyStatus(userStatus))

	// Add &quot;Admin&quot; status
	userStatus |= StatusAdmin
	fmt.Println(&quot;After adding Admin:&quot;, stringifyStatus(userStatus))

	// Remove &quot;Verified&quot; status using bitwise AND with NOT
	userStatus &amp;^= StatusVerified
	fmt.Println(&quot;After removing Verified:&quot;, stringifyStatus(userStatus))

	// Add &quot;Banned&quot; status
	userStatus |= StatusBanned
	fmt.Println(&quot;After adding Banned:&quot;, stringifyStatus(userStatus))

	// Check if the user is an admin
	if userStatus&amp;StatusAdmin != 0 {
		fmt.Println(&quot;User is an admin.&quot;)
	} else {
		fmt.Println(&quot;User is NOT an admin.&quot;)
	}

	// Remove &quot;Admin&quot; status using bitwise AND with NOT
	userStatus &amp;^= StatusAdmin
	fmt.Println(&quot;After removing Admin:&quot;, stringifyStatus(userStatus))

	// Check if the user is banned
	if userStatus&amp;StatusBanned != 0 {
		fmt.Println(&quot;User is banned.&quot;)
	} else {
		fmt.Println(&quot;User is NOT banned.&quot;)
	}

	// Check if the user is an admin
	if userStatus&amp;StatusAdmin != 0 {
		fmt.Println(&quot;User is an admin.&quot;)
	} else {
		fmt.Println(&quot;User is NOT an admin.&quot;)
	}
}
</code></pre>

</div>
</body>
</html>