# Mermaid Diagram Examples 

[View original Gist on GitHub](https://gist.github.com/Integralist/228d1c8b0d309a41de67afe09111f4eb)

**Tags:** #diagrams

## Mermaid Example.md

https://mermaid.js.org/  
https://mermaid.live/

```mermaid
---
title: Sequence Diagram example
---
sequenceDiagram
    autonumber
    participant cl AS Client
    participant avs AS API VCL Service (Edge)
    participant dag AS MyApp API Gateway (Edge)
    participant ag AS Auth Gateway (Control Plane)
    participant er AS Entity Registry (Control Plane)
    participant da AS MyApp API (Control Plane)
    
    %% below we put a note across MULTIPLE actors
    note over ag,da: here is my note

    cl->>+avs: Initial Request
    avs->>+dag: Proxy Request
    alt JWT Expired
        dag<<-->>ag: Exchange Fastly Key for JWT 
    end
    alt EntityID Not Found
        dag<<-->>er: Look up EntityId associated with CustomerId
    end
    dag->>+da: Proxy request to Origin
    da->>-dag: Origin response
    dag->>-avs: Respond to API VCL Service
    avs->>-cl: Respond to client
```

> [!NOTE]
> The yellow box is rendered by use of `+` and `-` before the target names.\
> e.g. `cl->>+avs: Initial Request` finishes with `avs->>-cl: Respond to client`

> [!TIP]
> Use `autonumber` to automatically number lines!

> [!TIP]
> You can comment out lines using `%%`.

```mermaid
---
title: Instant Onboarding - API Integration
---
sequenceDiagram
    participant ui AS MyApp UI
    participant dag AS MyApp API Gateway (Edge)
    participant da AS MyApp API (Control Plane)
    participant rd AS Redis (Cache)
    participant dns AS DNS (Resolution)

    ui->>dag: Initial request
    note right of ui: GET /internal/domains/v1/tools/lookup/{fqdn}
    dag->>+da: Proxy request to the API
    da->>rd: Lookup domain in cache
    alt No cache record Found
        note right of da: Query CNAME and SOA records
        da<<-->>dns: DNS lookup
    end
    da->>-ui: JSON response
```


```mermaid
---
title: Flowchart example
---
flowchart TD
    A[Christmas] -->|Get money| B(Go shopping)
    B --> C{Let me think}
    C -->|One| D[Laptop]
    C -->|Two| E[iPhone]
    C -->|Three| F[fa:fa-car Car]
```

> [!NOTE]
> `TB` - Top to bottom\
> `TD` - Top-down/ same as top to bottom\
> `BT` - Bottom to top\
> `RL` - Right to left\
> `LR` - Left to right

> [!TIP]
> For a flowchart, you can use either `flowchart` or `graph` (see below for example).

```mermaid
---
title: DNS CNAME/SOA Lookup Flow
---
graph TD
    A[Check for CNAME] --> B{CNAME Exists?};
    B -- Yes --> C[Check SOA of CNAME];
    B -- No --> D[Check SOA of APEX];
    C --> E{RNAME and MNAME match?};
    E -- Yes --> F[Return Hostname];
    E -- No --> G{Known RNAME match?};
    G -- Yes --> H[Return RNAME Hostname];
    G -- No --> I{Known MNAME match?};
    I -- Yes --> J[Return MNAME Hostname];
    I -- No --> D;
    D --> K{RNAME and MNAME match?};
    K -- Yes --> L[Return Hostname];
    K -- No --> M{Known RNAME match?};
    M -- Yes --> N[Return RNAME Hostname];
    M -- No --> O{Known MNAME match?};
    O -- Yes --> P[Return MNAME Hostname];
    O -- No --> Q[Return empty string];
```

```mermaid
---
title: Current TLS API Overview
---
graph LR
    A@{ shape: circle, label: "Customer" } --> B(TLS API);
    B --> C[[Spotless]];
    C --> D{API Routing};
    D --> E@{ shape: braces, label: "Activations" };
    D --> F@{ shape: braces, label: "Bulk" };
    D --> G@{ shape: braces, label: "Certificates" };
    D --> H@{ shape: braces, label: "Configuration" };
    D --> I@{ shape: braces, label: "Domains" };
    D --> J@{ shape: braces, label: "Mutual Authentication" };
    D --> K@{ shape: braces, label: "Private Keys" };
    D --> L@{ shape: braces, label: "Subscriptions" };
    L --> M{Certificate Authority CA};
    M --> N[[Let's Encrypt]]
    M --> O[[Certainly]]
    M --> P[[GlobalSign]]
```

```mermaid
---
title: Class Diagram example
---
classDiagram
    note "From Duck till Zebra"
    Animal <|-- Duck
    note for Duck "can fly\ncan swim\ncan dive\ncan help in debugging"
    Animal <|-- Fish
    Animal <|-- Zebra
    Animal : +int age
    Animal : +String gender
    Animal: +isMammal()
    Animal: +mate()
    class Duck{
        +String beakColor
        +swim()
        +quack()
    }
    class Fish{
        -int sizeInFeet
        -canEat()
    }
    class Zebra{
        +bool is_wild
        +run()
    }
```

```mermaid
---
title: State Diagram example
---
stateDiagram-v2
    [*] --> Still
    Still --> [*]

    Still --> Moving
    Moving --> Still
    Moving --> Crash
    Crash --> [*]
```

```mermaid
pie title Pie Chart example
    "Dogs" : 386
    "Cats" : 85
    "Rats" : 15
```

```mermaid
---
title: API Request Flow
---
erDiagram
    Customer ||--o{ TLSAPI : makes-requests-to
    TLSAPI ||--o{ SpotlessBackendAPI : communicates-with
    SpotlessBackendAPI {
        string API_Routing
    }
    SpotlessBackendAPI ||--o{ Activations : routes-to
    SpotlessBackendAPI ||--o{ Bulk : routes-to
    SpotlessBackendAPI ||--o{ Certificates : routes-to
    SpotlessBackendAPI ||--o{ Configurations : routes-to
    SpotlessBackendAPI ||--o{ Domains : routes-to
    SpotlessBackendAPI ||--o{ MutualAuthentication : routes-to
    SpotlessBackendAPI ||--o{ PrivateKeys : routes-to
    SpotlessBackendAPI ||--o{ Subscriptions : routes-to
    Subscriptions ||--o{ CertificateAuthority : communicates-with
```

```mermaid
sequenceDiagram
    participant Customer
    participant Spotless
    participant Ascerta
    participant Queue
    participant Worker

    Customer->>Spotless: POST /tls/subscriptions
    Spotless->>+Ascerta: https://<hostname>/internal/tls/v2/certs/...
    Note right of Spotless: include callback url
    par
        Ascerta-->>Queue: send request
    end
    Note right of Ascerta: include callback url
    Ascerta->>-Spotless: response
    Spotless->>Customer: 201 Created
    par
        Worker<<->>Queue: get item
        Worker->>Worker: do work
        Worker->>Spotless: https://<hostname>/internal/tls/v2/certs/...
        Note right of Spotless: the callback url
    end
```

```mermaid
---
title: NSQ Infrastructure
---
graph LR
    subgraph "Producer"
        A[API] -- push to topic --> CP((topic: priority))
        A -- push to topic --> CS((topic: standard))
        A -- push to topic --> CSP((topic: special))

        %% nsqd is the daemon that receives, queues, and distributes messages. 
        %% It acts as the message queue server.
        CP & CS & CSP -- send message --> N[nsqd]
    end

    subgraph " "
        %% nsqlookupd provides a directory service, 
        %% allowing consumers to find the nsqd instances that are producing messages 
        %%for a specific topic.
        N -- register topic --> L[nsqlookupd]
    end

    subgraph "Consumers"
        %% The consumers are trying to discover the nsqd instances 
        %% that are handling the specific topic they're interested in. 
        L <-- discover producers --> WP@{ shape: procs, label: "priority workers"}
        L <-- discover producers --> WS@{ shape: procs, label: "standard workers"}
        L <-- discover producers --> WSP@{ shape: procs, label: "special workers"}

        WP & WS & WSP <-- retrieve message --> N
    end
```

Below is an example of drawing boxes around specific parts of a system...

```mermaid
sequenceDiagram
    participant EU as End User
    participant RR as Recursive Resolver
    participant Root as Root Servers
    participant TLD as .com TLD Servers
    participant DS as DNSimple Servers <br/> (IPs via Glue Records for nsX.example.com)
    participant Cust as Customer
    participant UI as Example UI
    participant BE as Example Facade API Service
    participant API as DNSimple API
    participant DB as DNSimple Database

    box LightBlue DNS Resolution Process (Query for www.customerdomain.com)
        participant EU
        participant RR
        participant Root
        participant TLD
    end

    box Pink Record Management Process (Customer updates DNS)
        participant Cust
        participant UI
        participant BE
        participant API
    end

    Note over EU, DS: Initial Setup Prerequisite (Not Shown):<br/>1. Vanity NS (nsX.example.com) configured in DNSimple.<br/>2. Glue Records created at example.com's registrar mapping nsX.example.com to DNSimple IPs.<br/>3. customerdomain.com's NS records point to nsX.example.com.

    %% === DNS Resolution Flow ===
    EU->>+RR: Resolve www.customerdomain.com?
    RR->>+Root: Who handles .com?
    Root-->>-RR: TLD Server IPs
    RR->>+TLD: Who handles customerdomain.com?
    TLD-->>-RR: NS: ns1.example.com @ DNSimple_IP1<br/>NS: ns2.example.com @ DNSimple_IP2<br/>(Info via Glue Records)
    RR->>+DS: (Query sent to DNSimple_IP1) A record for www.customerdomain.com?
    DS-->>-RR: A record is 192.0.2.100
    RR-->>-EU: www.customerdomain.com is 192.0.2.100
    EU->>(Web Server): Connect to 192.0.2.100

    %% === Record Management Flow ===
    Cust->>+UI: Login & Navigate to manage.example.com
    Cust->>UI: Request Add/Update Record (e.g., TXT _foo="bar")
    UI->>+BE: Submit Record Change Request (domain, type, name, content)
    BE->>+API: Create/Update Record via DNSimple API<br/>(Zone: customerdomain.com, Record Details)
    API->>+DB: Store/Update record data in DNSimple's database
    Note over DB, DS: DNSimple internal propagation<br/>updates authoritative servers (DS).
    DB-->>-API: Confirmation of data update
    API-->>-BE: Success Response (e.g., Record ID)
    BE-->>-UI: Operation Successful
    UI-->>-Cust: Display success message / updated record list

    Note right of DS: DNSimple Servers (DS)<br/>now serve the<br/>new/updated record<br/>for future queries.
```

